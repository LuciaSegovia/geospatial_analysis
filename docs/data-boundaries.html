<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Boundaries of Malawi – Reproducible documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./data-maize.html" rel="next">
<link href="./data-dhs.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8da5b4427184b79ecddefad3d342027e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="site_libs/datatables-binding-0.33/datatables.js"></script>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="site_libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">

<script src="site_libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>

<link href="site_libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">

<script src="site_libs/selectize-0.12.0/selectize.min.js"></script>

<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>



</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./data-boundaries.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Boundaries of Malawi</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Reproducible documentation</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-cloud-arrow-down"></i></a>
    <a href="https://github.com/LuciaSegovia/geospatial_analysis/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Reproducible-documentation.pdf">
              <i class="bi bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Reproducible-documentation.epub">
              <i class="bi bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-1" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-1">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-description.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Methods: Datasets &amp; Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-dhs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Methods: Cleaning &amp; Exploratory Analysis of the Malawi DHS (2015-2016)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-boundaries.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Boundaries of Malawi</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-maize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Cleaning maize grain Se concentration in Malawi</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predicted-maize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Methods: Generating predicted maize grain Se concentration for Malawi</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Methods: Data processing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maize-aggregation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Model preparation: Maize aggregation and data combination</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inla.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Methods: Modelling with R-INLA</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#administrative-boundaries" id="toc-administrative-boundaries" class="nav-link active" data-scroll-target="#administrative-boundaries"><span class="header-section-number">3.0.1</span> Administrative boundaries</a></li>
  <li><a href="#sec-boundaries" id="toc-sec-boundaries" class="nav-link" data-scroll-target="#sec-boundaries"><span class="header-section-number">3.1</span> Generating boundaries for maize aggregation levels</a>
  <ul class="collapse">
  <li><a href="#administrative-boundaries-areas" id="toc-administrative-boundaries-areas" class="nav-link" data-scroll-target="#administrative-boundaries-areas"><span class="header-section-number">3.1.1</span> Administrative boundaries areas</a></li>
  <li><a href="#household-catchment-areas-buffer" id="toc-household-catchment-areas-buffer" class="nav-link" data-scroll-target="#household-catchment-areas-buffer"><span class="header-section-number">3.1.2</span> Household catchment areas (buffer)</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/LuciaSegovia/geospatial_analysis/edit/main/data-boundaries.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/LuciaSegovia/geospatial_analysis/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-explo-bound" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Boundaries of Malawi</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this study, we are trying to identify the optimal level of aggregation of maize grain Se composition data, hence different set of spatial aggregation units (areal units) were generated based on the administrative units of the country (Admin level 4 - EAs, Admin level 2 - districts), and based on household locations. For instance, areas based on the clusters reported in the DHS dataset. Therefore, spatial information regarding the boundaties (i.e., shapefiles) of Malawi are necesiary for our analysis.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep) <span class="co"># grid and neighbours</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster) <span class="co"># (spatial) raster data manipulation</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># data wrangling </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr) <span class="co"># string data manipulation </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># data visualisation</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># spatial data manipulation</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap) <span class="co"># spatial data visualisation</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT) <span class="co"># pretty &amp; interactive tables</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading data</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Admin Boundaries for Malawi: EAs</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>ea_bnd  <span class="ot">&lt;-</span> <span class="fu">st_read</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"mwi-boundaries"</span>, <span class="st">"EN_NSO"</span> , <span class="st">"eas_bnd.shp"</span>), </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># TAs</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>ta_bnd  <span class="ot">&lt;-</span> <span class="fu">st_read</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"mwi-boundaries"</span>,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"mwi_adm_nso_hotosm_20230329_shp"</span>, </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"mwi_admbnda_adm3_nso_hotosm_20230329.shp"</span>), </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Districts</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>dist_bnd  <span class="ot">&lt;-</span> <span class="fu">st_read</span>(here<span class="sc">::</span><span class="fu">here</span>( <span class="st">"data"</span>,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"mwi-boundaries"</span>,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"mwi_adm_nso_hotosm_20230329_shp"</span>, </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"mwi_admbnda_adm2_nso_hotosm_20230329.shp"</span>), <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>dist_bnd <span class="ot">&lt;-</span> <span class="fu">st_make_valid</span>(dist_bnd) <span class="co"># Check this</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Maize Se conc.(from cleaned from 00_cleaning-maize.R)</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>maize.df<span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"inter-output"</span>, <span class="st">"mwi-grain-se_raw.RDS"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>   <span class="do">## Getting only entries with maize Se values</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Se_raw) <span class="sc">&amp;</span> Crop <span class="sc">==</span> <span class="st">"Maize"</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Plasma Se conc. (cleaned from 00_cleaning-dhs.R)</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>plasma.df  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"inter-output"</span>,<span class="st">"dhs_se_gps.rds"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># removing entries with missing values in plasma Se conc.</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(selenium))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We accessed and explored a number of boundaries from different sources to identify those that were of enough quality and useful for our analysis (i.e.&nbsp;data provenance is found in <a href="data-description.html#sec-bound" class="quarto-xref"><span>Section 1.3</span></a>). Documenting the cleaning and decision made,and the final datasets used is the purpose of this section.</p>
<section id="administrative-boundaries" class="level3" data-number="3.0.1">
<h3 data-number="3.0.1" class="anchored" data-anchor-id="administrative-boundaries"><span class="header-section-number">3.0.1</span> Administrative boundaries</h3>
<p>In order to identify where the data collected, both maize samples and clusters shapefiles (i.e., spatial datasets) with the boundaries (polygons) of each administrative units must be used. Particuarly for EAs, as that information is not provided by any of the datasets used.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing lakes from boundaries dataset</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting only variables that are interesting </span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fid, EA code, TA name, TA code, district, dist code, EA area &amp; geometry)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>ea_admin <span class="ot">&lt;-</span> ea_bnd <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"lake"</span>, DISTRICT,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">17</span>, <span class="dv">18</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop for adding the region Northern-Southern (1-3)</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>ea_admin<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  ea_admin<span class="sc">$</span>region[<span class="fu">grepl</span>(<span class="fu">paste0</span>(<span class="st">"^"</span>, i), ea_admin<span class="sc">$</span>EACODE)] <span class="ot">&lt;-</span> i</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>ea_admin <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(region))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 0 features and 8 fields
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Geodetic CRS:  WGS 84
[1] fid       EACODE    TA        TA_CODE   DISTRICT  DIST_CODE AREA_KM  
[8] geometry  region   
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<p>We have found several shape files with the boundaries for Malawi (See <a href="data-description.html#sec-bound" class="quarto-xref"><span>Section 1.3</span></a>). After exploring the boundaries datasets (pre-exploration using QGIS version (3.28.3) Firenze), we selected two data files: one for the EAs, the boundaries 3 (<span class="citation" data-cites="ref-NSO">(<a href="references.html#ref-ref-NSO" role="doc-biblioref"><strong>ref-NSO?</strong></a>)</span>) (<code>ea_bnd</code>) as the source of the polygons of each of the n= 9219 EAs. As this was the only file with information at that administrative level. This file contains some variables that were not necessary, and it also contained the shape of the lakes in Malawi. This were removed, and the trimmed dataset was used for further steps.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Combining EAs with "authentic" District</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>ea_admin <span class="ot">&lt;-</span>  <span class="fu">st_join</span>(ea_admin, dist_bnd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Additionally, due to the sensitive nature of the EAs (i.e., used in census data and due to issues with breaching the confideciality of the data), the file is old (2013) hence the district are not up to date. For the districts to match the current official country boundaries and those reported in the DHS dataset, we are using those reported in boundaries <code>dist_bnd</code>, also generated by the NSO, and more recent (2023). This is particularly problematic as the district “Mwanza” was splited into two District “Mwanza” and “Neno”, which is not found in the file with the EAs.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(ea_admin <span class="sc">%&gt;%</span> <span class="fu">filter</span>(DISTRICT <span class="sc">%in%</span> <span class="st">"Mwanza"</span>)) <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(dist_bnd <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ADM2_EN <span class="sc">%in%</span> <span class="st">"Mwanza"</span>)) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"ADM2_EN"</span>, <span class="at">col_alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(ea_admin<span class="sc">$</span>geometry[ea_admin<span class="sc">$</span>EACODE <span class="sc">%in%</span> ea_admin<span class="sc">$</span>EACODE[<span class="fu">is.na</span>(ea_admin<span class="sc">$</span>ADM2_PCODE) <span class="sc">&amp;</span> ea_admin<span class="sc">$</span>DISTRICT <span class="sc">==</span> <span class="st">"Mwanza"</span>]]) <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>( <span class="at">fill =</span> <span class="st">"red"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-6" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-boundaries_files/figure-html/fig-6-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1: Location of the EAs ( 30601009 ) in Mwanza/Neno district.
</figcaption>
</figure>
</div>
</div>
</div>
<p>To solve this, the two files were combined together however, some discrepancies arose. For instance, eight observations did not have a district. We visually checked the location of each “missing EA” within their districts, as it can be seen in the script (<code>00_cleaning-boundaries.R</code>). We added that information to each EA of their corresponding districts following in the “old” (<code>ea_bnd</code>) file but for the EAs in Mwanza as they lied in Neno, as it can be seen in the <a href="#fig-6" class="quarto-xref">Figure&nbsp;<span>3.1</span></a>.</p>
<p>The EA that was manually recoded to the current corresponding distrinct.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ea_admin<span class="sc">$</span>ADM2_EN[<span class="fu">is.na</span>(ea_admin<span class="sc">$</span>ADM2_PCODE) <span class="sc">&amp;</span> ea_admin<span class="sc">$</span>DISTRICT <span class="sc">==</span> <span class="st">"Mwanza"</span>] <span class="ot">&lt;-</span> <span class="st">"Neno"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, this file with the EAs and the correct district was save as a shapefile, and it will be used in further steps.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Saving the new dataset with "correct" district for each EA ----</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(ea_admin, here<span class="sc">::</span><span class="fu">here</span>( <span class="st">"data"</span>, <span class="st">"inter-output"</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">"boundaries"</span>, <span class="st">"mwi_admbnda_adm4_nso.shp"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="limitation-of-the-admin-boundaries-data" class="level4" data-number="3.0.1.1">
<h4 data-number="3.0.1.1" class="anchored" data-anchor-id="limitation-of-the-admin-boundaries-data"><span class="header-section-number">3.0.1.1</span> Limitation of the admin boundaries data</h4>
<p>The <strong>first issue</strong> that we encountered was that not many of the files have the boundaries at EA level. This is due to the confidentiality and sensitivity of the data, as those are the clusters used for most of the survey and are bases on the census data.</p>
<p>The <strong>second issue</strong> was that some boundaries are not accurate/ well-defined. For instance, in the dataset 1 (GADM), which is a good source of countries boundaries, lake Malawi was included into the admin boundaries. Hence, when using the boundaries to locate the HHs and/or maize it seemed that part of the household were falling inside Lake Malawi. If we try to remove the lake area it leads to the missing of some observations.</p>
<p>The <strong>third issue</strong> we found was inconsistency between datasets. Although they are hosted in different repositories/websites, the boundaries <code>ea_bnd</code> and <code>ta_bnd</code> are apparently produced by the NSO, yet, the number of TA are different (n=351) and (n=433). The disagreement may be due to the inclusion of sub-divided TA (i.e., TSA) in the dataset <code>ta_bnd</code>, or due differences on the date of the datasets. There are are small differences in the codes used between the datasets which may yielded further inconsistencies between the two. Hence, we decided to exclude the TA boundaries for further analysis and do not aggregate at this level. In addition, after discussing with GO and EJ, they agreed that TA may be inconsistent boundaries and that may have some political/ local sensibilities.</p>
<p>More info (on practical steps &amp; tested things on the notebook <code>Suppl_boundaries_notes.qmd</code>).</p>
</section>
</section>
<section id="sec-boundaries" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-boundaries"><span class="header-section-number">3.1</span> Generating boundaries for maize aggregation levels</h2>
<p>In order to calculate the mean/median value for each level of aggregation first, we need to generate the boundaries that will be used.</p>
<p>The first two aggregations (areal units) were based on administrative boundaries (i.e., EAs, districts) whereas the other two aggregation levels were based on the <em>food catchment area</em> or <em>food-sheds</em> (buffer area). All of the aggregation units took into consideration the cluster displacement nature of the location.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The location (GPS coordinates) provided in the DHS are for each cluster, not per individual or household (i.e., one women or more will share the <strong><em>exact</em></strong> same GPS coordinates).</p>
</div>
</div>
<section id="administrative-boundaries-areas" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="administrative-boundaries-areas"><span class="header-section-number">3.1.1</span> Administrative boundaries areas</h3>
<p>We started with the EAs because are the smallest administrative units, and they are nested within the other (bigger) administrative units (Districts and Regions).</p>
<p>Due to the nature of the displaced cluster location, the smallest administrative unit will not be one EA per women, but a number of EAs per cluster for all the women living in the same cluster. For more information on the GPS displacement see <a href="data-dhs.html#sec-gps-location" class="quarto-xref"><span>Section 2.4</span></a> and the Guidelines on the Use of DHS GPS Data from <span class="citation" data-cites="perez2013guidelines">Perez-Heydrich et al. (<a href="references.html#ref-perez2013guidelines" role="doc-biblioref">2013</a>)</span>.</p>
<p>The EAs included in each cluster are based on the displacement range (2.5km for urban and 5km per rural) bounded by district, full details are disclosed below. While for the district information it was provided within the DHS dataset.</p>
<section id="enumeration-areas" class="level4" data-number="3.1.1.1">
<h4 data-number="3.1.1.1" class="anchored" data-anchor-id="enumeration-areas"><span class="header-section-number">3.1.1.1</span> Enumeration Areas</h4>
<p>In the DHS plasma dataset, we do not have information about the EAs where each women or cluster point lies in. Therefore, in order to calculate the mean/media maize Se concentration for each administrative unit, we need to identify the EAs that were plausible residing place for the women in the DHS survey, as mentioned above. The buffer areas were added in previous step (See <a href="data-dhs.html#sec-gps-location" class="quarto-xref"><span>Section 2.4</span></a>).</p>
<p>To do so, we need to spatially merge the boundaries dataset (<code>ea_admin</code>) and the plasma Se dataset. Hence, some data preparation need to be done before carrying the spatial join. For instance, both datasets need to be spatial objects.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking the class of the two datasets</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(ea_admin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "data.frame"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(plasma.df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p>We can see that the <code>plasma.df</code> is not a spatial object. Therefore, we need to use the <code>sf package</code> to convert it into a spatial dataset. Here, we are interested in the buffer areas and that is the variable that was converted into the geometry variable.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting only cluster location (to avoid duplicates)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>geodata.df <span class="ot">&lt;-</span> plasma.df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(survey_cluster1, buffer) <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># renaming buffer as geometry for converting into spatial object</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">geometry =</span> <span class="st">"buffer"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_sf</span>(., <span class="at">crs =</span> <span class="st">"EPSG:4326"</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking the effect of the line above</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(geodata.df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p>Then, after converting and checking that the <code>plasma.df</code> is a spatial object, we can proceed with the spatial join to identify the Malawi EAs (<code>ea_admin</code>) within the buffered areas for each cluster.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting info on the admin boundaries (EA/district level)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Allocating buffered areas to each admin unit</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>geodata_ea <span class="ot">&lt;-</span>  <span class="fu">st_join</span>(geodata.df, ea_admin)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>geodata_ea<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(geodata_ea<span class="sc">$</span>region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In the <a href="#fig-map2" class="quarto-xref">Figure&nbsp;<span>3.2</span></a>, we can see, in dark red, the EAs that were within the buffered areas, and in blue the buffers.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate boundaries the whole country (with lakes)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>malawi_bnd_lakes <span class="ot">&lt;-</span> <span class="fu">st_union</span>(ea_bnd)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate boundaries the whole country</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>malawi_bnd <span class="ot">&lt;-</span> <span class="fu">st_union</span>(ea_admin)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_mode("view")</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Generating the map</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(ea_admin) <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">fill =</span> <span class="st">"white"</span>, </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">col =</span> <span class="st">"#666666"</span>, <span class="at">col_alpha =</span> <span class="fl">0.3</span>, <span class="at">lwd =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(malawi_bnd) <span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"#666666"</span>, <span class="at">fill_alpha =</span> <span class="fl">0.6</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(malawi_bnd_lakes) <span class="sc">+</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">fill_alpha =</span> <span class="fl">0.6</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_shape</span>(ea_admin<span class="sc">$</span>geometry[ea_admin<span class="sc">$</span>EACODE <span class="sc">%in%</span> <span class="fu">unique</span>(geodata_ea<span class="sc">$</span>EACODE)]) <span class="sc">+</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">fill =</span><span class="st">"firebrick4"</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">col_alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a> <span class="fu">tm_shape</span>(geodata.df) <span class="sc">+</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"steelblue"</span>)<span class="co"># +</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co">#tm_view(set.view = c(-13.2284,8.4699, 13), set.zoom.limits = c(13,14))</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_mode("plot")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-map2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-map2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-boundaries_files/figure-html/fig-map2-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-map2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2: Map of Malawi with the possible EAs where the household that were surveyed in the DHS-MNS may reside (in dark red), and the buffer representing the GPS displacement (in blue).
</figcaption>
</figure>
</div>
</div>
</div>
<p>When we checked the EAs that were included in each cluster, we realised that there were some clusters that were very close to the district boundaries, thus including some EAs from different district. According to the DHS documentation, displacement was performed to respect district boundaries, hence households will be within their district (see district information on DHS dataset) and because here we are looking at administrative boundaries, we need to remove the EAs that did not belong to the district for each cluster.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking the EAs per buffer and district</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>(g1 <span class="ot">&lt;-</span> geodata_ea <span class="sc">%&gt;%</span>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="st">"survey_cluster1"</span>, as.character) <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(survey_cluster1, survey_cluster1, <span class="cf">function</span>(x)<span class="sc">-</span><span class="fu">length</span>(x)))) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> DISTRICT)) <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Cluster"</span>) <span class="sc">+</span> </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>), </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">angle =</span><span class="dv">30</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-dist1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dist1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-boundaries_files/figure-html/fig-dist1-1.png" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dist1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3: The bars show the number of EAs in each DHS cluster and the colours represent the districts.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Moreover, we can see in <a href="#fig-dist2" class="quarto-xref">Figure&nbsp;<span>3.4</span></a> that some buffer-cluster areas extended beyond the district including district from different regions.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>g1 <span class="sc">+</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>region, <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Northern"</span>, </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                                               <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Central"</span>, </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                                               <span class="st">`</span><span class="at">3</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Southern"</span>)),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-dist2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dist2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-boundaries_files/figure-html/fig-dist2-1.png" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dist2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.4: The bars show the number of EAs in each DHS cluster divided by regions and the colours represent the districts.
</figcaption>
</figure>
</div>
</div>
</div>
<p>We identified the correct district for each EA by combining the district names (<code>dist_name</code>) in the DHS survey and the district names (<code>ADM2_EN</code>) in the <code>ea_admin</code> dataset. For more information on that dataset and variables see <a href="#sec-explo-bound" class="quarto-xref"><span>Chapter 3</span></a>.</p>
<p>Some minor spelling adjustment was needed in order to identify the correct district and a dummy variable to check district name consistency was generated, as shown in the following code block.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking the districts in plasma dataset</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting back from spatial obj to dataframe</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>plasma.df  <span class="ot">&lt;-</span> geodata_ea  <span class="sc">%&gt;%</span> <span class="fu">st_drop_geometry</span>()  <span class="sc">%&gt;%</span>  <span class="co"># removing geometry</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(., plasma.df, <span class="at">relationship =</span> <span class="st">"many-to-many"</span>)  <span class="co"># multiple EAs per cluster,                                                         multiple WRA per cluster. </span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># New variable to check the correct district (based on survey)</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>plasma.df<span class="sc">$</span>dist_name2 <span class="ot">&lt;-</span> <span class="fu">as.character</span>(plasma.df<span class="sc">$</span>dist_name)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Changing the spelling to fit the NSO boundaries file </span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>plasma.df<span class="sc">$</span>dist_name2 <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"nkhota kota"</span>, <span class="st">"nkhotakota"</span>, plasma.df<span class="sc">$</span>dist_name2)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>plasma.df<span class="sc">$</span>dist_name2 <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"lilongwe rural"</span>, <span class="st">"lilongwe"</span>, plasma.df<span class="sc">$</span>dist_name2)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>plasma.df<span class="sc">$</span>dist_name2 <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"ndanje"</span>, <span class="st">"nsanje"</span>, plasma.df<span class="sc">$</span>dist_name2)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>plasma.df<span class="sc">$</span>dist_name2 <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"zomba rural"</span>, <span class="st">"zomba"</span>, plasma.df<span class="sc">$</span>dist_name2)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>plasma.df<span class="sc">$</span>dist_name2 <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"blantyre rural"</span>, <span class="st">"blantyre"</span>, plasma.df<span class="sc">$</span>dist_name2)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>plasma.df<span class="sc">$</span>dist_name2 <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"mulange"</span>, <span class="st">"mulanje"</span>, plasma.df<span class="sc">$</span>dist_name2)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>plasma.df<span class="sc">$</span>dist_name2 <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"chradzulu"</span>, <span class="st">"chiradzulu"</span>, plasma.df<span class="sc">$</span>dist_name2)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Dummy variable to check whether districts are the same or not</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>plasma.df<span class="sc">$</span>boundaries_check <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">tolower</span>(plasma.df<span class="sc">$</span>ADM2_EN) <span class="sc">==</span> plasma.df<span class="sc">$</span>dist_name2, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking district that are the same and those with NA (some dist_name were NA)</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>plasma.df <span class="sc">%&gt;%</span>  dplyr<span class="sc">::</span><span class="fu">filter</span>(boundaries_check <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">|</span> <span class="fu">is.na</span>(boundaries_check) ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(survey_cluster1, ADM2_EN, dist_name2, boundaries_check) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Changing the class of the cluster for table improvement</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="st">"survey_cluster1"</span>, as.character) <span class="sc">%&gt;%</span> </span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the interactive table</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(., <span class="at">filter =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-2a1540fbffe58d85aeb9" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2a1540fbffe58d85aeb9">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"logical\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;true&quot;,&quot;false&quot;,&quot;na&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103"],["782","140","114","219","369","58","294","498","468","398","459","361","813","388","86","507","817","461","497","389","242","185","18","6","641","420","205","387","37","342","405","223","136","822","772","827","607","448","315","209","825","192","670","150","517","170","736","435","777","271","240","5","245","743","303","344","234","23","23","410","218","64","842","253","145","401","276","195","444","190","74","720","704","16","200","43","101","309","178","830","162","780","531","571","227","464","676","665","238","836","601","511","829","377","832","194","96","232","505","503","270","593","193"],["Neno","Chitipa","Rumphi","Nkhotakota","Lilongwe","Nsanje","Lilongwe","Dowa","Phalombe","Blantyre City","Karonga","Karonga","Chitipa","Karonga","Chitipa","Karonga","Chitipa","Chitipa","Rumphi","Rumphi","Rumphi","Nkhatabay","Mzimba","Mzimba","Nkhatabay","Mzimba","Nkhatabay","Mzuzu City","Mzuzu City","Nkhatabay","Rumphi","Kasungu","Ntchisi","Kasungu","Kasungu","Nkhotakota","Nkhotakota","Nkhotakota","Kasungu","Salima","Salima","Salima","Dowa","Ntchisi","Lilongwe","Salima","Mchinji","Mchinji","Lilongwe City","Mchinji","Ntcheu","Mchinji","Dedza","Balaka","Balaka","Mangochi","Mangochi","Mangochi",null,"Machinga","Zomba","Zomba","Zomba","Phalombe","Blantyre","Phalombe","Mulanje","Neno","Thyolo","Blantyre City","Mwanza","Mwanza","Thyolo","Nsanje","Nsanje","Chikwawa","Rumphi","Karonga","Karonga","Karonga","Chitipa","Rumphi","Nkhatabay","Nkhatabay","Nkhatabay","Mzimba","Mzimba","Ntchisi","Dowa","Dowa","Ntcheu","Dedza","Dedza","Ntcheu","Ntcheu","Mulanje","Mulanje","Chiradzulu","Chikwawa","Thyolo","Mzimba","Chiradzulu","Chiradzulu"],["neno","chitipa","rumphi","nkhotakota","lilongwe","nsanje","lilongwe","dowa","phalombe","blantyre city","karonga","karonga","chitipa","karonga","chitipa","karonga","chitipa","chitipa","rumphi","rumphi","rumphi","nkhatabay","mzimba","mzimba","nkhatabay","mzimba","nkhatabay","mzuzu city","mzuzu city","nkhatabay","rumphi","kasungu","ntchisi","kasungu","kasungu","nkhotakota","nkhotakota","nkhotakota","kasungu","salima","salima","salima","dowa","ntchisi","lilongwe","salima","mchinji","mchinji","lilongwe city","mchinji","ntcheu","mchinji","dedza","balaka","balaka","mangochi","mangochi","mangochi","mangochi","machinga","zomba","zomba","zomba","phalombe","blantyre","phalombe","mulanje","neno","thyolo","blantyre city","mwanza","mwanza","thyolo","nsanje","nsanje","chikwawa","rumphi","karonga","karonga","karonga","chitipa","rumphi","nkhatabay","nkhatabay","nkhatabay","mzimba","mzimba","ntchisi","dowa","dowa","ntcheu","dedza","dedza","ntcheu","ntcheu","mulanje","mulanje","chiradzulu","chikwawa","thyolo","mzimba","chiradzulu","chiradzulu"],[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,null,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>survey_cluster1<\/th>\n      <th>ADM2_EN<\/th>\n      <th>dist_name2<\/th>\n      <th>boundaries_check<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"survey_cluster1","targets":1},{"name":"ADM2_EN","targets":2},{"name":"dist_name2","targets":3},{"name":"boundaries_check","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>After checking that all the survey cluster has the correct district, and indentifying the “wrong” districts, those that were “self-included” due to the EAs that were falling within the displacement buffer.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Showing the table with the EACODEs and the "wrong" districts</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>plasma.df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(boundaries_check <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(survey_cluster1, EACODE, ADM2_EN, dist_name2, boundaries_check) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Changing the class of the cluster for table improvement</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="st">"survey_cluster1"</span>, as.character) <span class="sc">%&gt;%</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the interactive table</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(., <span class="at">filter =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-8e95bbb3d67905b48343" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8e95bbb3d67905b48343">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"10103008\" data-max=\"31202052\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"logical\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;true&quot;,&quot;false&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260"],["114","114","114","114","114","369","369","369","468","468","468","468","468","468","468","468","468","468","468","468","398","398","86","461","461","461","461","389","389","242","242","242","242","242","185","185","641","205","205","205","387","387","387","37","37","37","37","405","405","405","405","405","223","223","223","136","136","136","136","136","607","209","209","209","209","209","825","825","825","825","825","825","670","670","670","670","670","670","670","670","670","150","736","435","435","435","435","435","435","435","435","435","435","777","777","245","245","245","245","245","245","245","245","245","245","245","743","743","743","743","743","303","344","344","344","344","344","344","344","344","344","218","218","218","218","218","218","218","64","64","64","64","842","842","253","253","253","253","253","253","253","253","253","401","401","401","401","276","276","276","276","276","276","276","276","276","276","276","276","276","276","276","276","276","276","276","444","74","74","74","720","720","720","720","200","200","200","200","200","200","200","200","200","200","200","200","200","200","200","200","200","43","43","43","43","43","101","101","101","101","101","101","101","178","178","780","780","665","665","665","665","665","665","665","665","665","836","836","836","232","232","232","232","232","270","593","593","593","593","593","593","193","193","193","193","193","193","193","193","193","193","193","193","193","193","193","193","193","193","193","193","193","193","193","193","193","193","193","193","193"],[10420702,10401032,10420703,10420706,10502004,20615004,20615002,20615005,30901164,30901148,30901161,30901159,30805015,30901154,30807901,30901158,30805016,30805017,30805019,30805018,30533003,30533002,10106902,10203001,10203901,10103008,10103009,10410901,10410901,10502002,10401032,10401025,10502003,10502001,10301901,10301006,10309004,10312901,10301906,10301906,10533001,10533001,10532001,10533001,10533001,10542001,10543001,10420702,10401037,10420703,10420706,10502004,20101009,20101021,20101022,20304001,20305901,20304002,20304003,20301901,20201011,20504907,20804901,20804901,20804004,20804005,20404040,20404039,20404037,20404036,20404041,20404042,20405001,20405021,20683004,20683005,20683001,20683008,20683002,20683006,20683007,20305901,20706027,20706028,20606014,20606014,20704054,20704054,20704052,20606028,20606027,20606034,20606035,20611021,20612001,20803001,20604073,20803007,20604074,20803008,20604079,20803012,20803013,20610036,20803014,20803015,30211901,30211901,31202052,31202052,31202014,31201092,30106076,30209011,30106074,30106073,30106070,30106071,30201007,30201004,30201005,30307901,30335001,30307033,30301044,30335002,30335004,30335003,30307902,30307008,30301008,30307009,30305020,30305021,30901017,30901019,30901020,30901021,30305096,30305096,30901023,30901023,30901025,30901165,30901164,30901902,30901161,30403060,30403024,30806023,30403027,30403029,30806030,30403028,30403040,30403042,30403043,30403062,30403061,30403059,30403063,30403065,30403064,30403066,30403067,30403069,30704902,31003004,31003005,31003006,31009901,31009901,30603018,30607902,31001055,31106001,31001090,31001092,31001091,31001093,31106002,31001096,31001097,31001094,31106006,31001099,31001095,31106007,31001098,31106008,31106011,31006001,31006003,31006004,30508009,31006005,10206903,10410901,10410901,10204019,10404002,10405001,10404001,10404002,10404003,10407010,10407011,20305003,20113014,20113013,20305001,20305001,20112043,20305002,20305007,20305006,20606001,20403005,20606005,30405016,30405018,30507004,30401021,30401022,10507021,30406022,30406026,30406028,30806023,30403027,30403028,30305012,30305004,30305006,30305005,30305007,30305015,30305011,30305017,30305016,30305009,30305018,30305010,30406001,30305008,30305019,30305020,30406005,30305025,30406006,30406004,30305021,30305023,30305024,30406007,30305044,30406008,30305022,30406014,30406015],["Mzimba","Mzimba","Mzimba","Mzimba","Mzimba","Dowa","Dowa","Dowa","Mulanje","Mulanje","Mulanje","Mulanje","Mulanje","Mulanje","Mulanje","Mulanje","Mulanje","Mulanje","Mulanje","Mulanje","Chiradzulu","Chiradzulu","Karonga","Karonga","Karonga","Karonga","Karonga","Chitipa","Karonga","Mzimba","Mzimba","Mzimba","Mzimba","Mzimba","Mzimba","Mzimba","Mzimba","Mzimba","Mzimba","Mzuzu City","Mzimba","Nkhatabay","Mzimba","Mzimba","Nkhatabay","Mzimba","Mzimba","Mzimba","Mzimba","Mzimba","Mzimba","Mzimba","Mzimba","Mzimba","Mzimba","Nkhotakota","Nkhotakota","Nkhotakota","Nkhotakota","Nkhotakota","Mzimba","Dedza","Dedza","Lilongwe","Dedza","Dedza","Dowa","Dowa","Dowa","Dowa","Dowa","Dowa","Lilongwe","Lilongwe City","Lilongwe City","Lilongwe City","Lilongwe City","Lilongwe City","Lilongwe City","Lilongwe City","Lilongwe City","Nkhotakota","Kasungu","Kasungu","Kasungu","Lilongwe","Kasungu","Lilongwe","Lilongwe","Lilongwe","Lilongwe","Lilongwe","Lilongwe","Lilongwe","Lilongwe","Lilongwe","Lilongwe","Lilongwe","Lilongwe","Lilongwe","Lilongwe","Lilongwe","Lilongwe","Lilongwe","Lilongwe","Lilongwe","Machinga","Mangochi","Machinga","Mangochi","Mangochi","Ntcheu","Machinga","Machinga","Machinga","Machinga","Machinga","Machinga","Machinga","Machinga","Machinga","Zomba City","Zomba City","Zomba City","Zomba City","Zomba City","Zomba City","Zomba City","Machinga","Machinga","Machinga","Machinga","Chiradzulu","Chiradzulu","Zomba","Zomba","Zomba","Zomba","Mulanje","Zomba","Mulanje","Zomba","Mulanje","Mulanje","Mulanje","Mulanje","Mulanje","Chiradzulu","Chiradzulu","Chiradzulu","Chiradzulu","Chiradzulu","Chiradzulu","Chiradzulu","Chiradzulu","Chiradzulu","Chiradzulu","Chiradzulu","Chiradzulu","Chiradzulu","Chiradzulu","Chiradzulu","Chiradzulu","Chiradzulu","Chiradzulu","Chiradzulu","Chikwawa","Chikwawa","Chikwawa","Chikwawa","Blantyre","Chikwawa","Neno","Neno","Chikwawa","Chikwawa","Chikwawa","Chikwawa","Chikwawa","Chikwawa","Chikwawa","Chikwawa","Chikwawa","Chikwawa","Chikwawa","Chikwawa","Chikwawa","Chikwawa","Chikwawa","Chikwawa","Chikwawa","Blantyre","Blantyre","Blantyre","Blantyre","Blantyre","Karonga","Chitipa","Karonga","Karonga","Karonga","Karonga","Karonga","Rumphi","Rumphi","Mzimba","Mzimba","Kasungu","Kasungu","Kasungu","Kasungu","Nkhotakota","Kasungu","Kasungu","Kasungu","Nkhotakota","Lilongwe","Lilongwe","Lilongwe","Blantyre","Blantyre","Blantyre","Blantyre","Blantyre","Kasungu","Zomba","Zomba","Zomba","Mulanje","Mulanje","Mulanje","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba","Zomba"],["rumphi","rumphi","rumphi","rumphi","rumphi","lilongwe","lilongwe","lilongwe","phalombe","phalombe","phalombe","phalombe","phalombe","phalombe","phalombe","phalombe","phalombe","phalombe","phalombe","phalombe","blantyre city","blantyre city","chitipa","chitipa","chitipa","chitipa","chitipa","rumphi","rumphi","rumphi","rumphi","rumphi","rumphi","rumphi","nkhatabay","nkhatabay","nkhatabay","nkhatabay","nkhatabay","nkhatabay","mzuzu city","mzuzu city","mzuzu city","mzuzu city","mzuzu city","mzuzu city","mzuzu city","rumphi","rumphi","rumphi","rumphi","rumphi","kasungu","kasungu","kasungu","ntchisi","ntchisi","ntchisi","ntchisi","ntchisi","nkhotakota","salima","salima","salima","salima","salima","salima","salima","salima","salima","salima","salima","dowa","dowa","dowa","dowa","dowa","dowa","dowa","dowa","dowa","ntchisi","mchinji","mchinji","mchinji","mchinji","mchinji","mchinji","mchinji","mchinji","mchinji","mchinji","mchinji","lilongwe city","lilongwe city","dedza","dedza","dedza","dedza","dedza","dedza","dedza","dedza","dedza","dedza","dedza","balaka","balaka","balaka","balaka","balaka","balaka","mangochi","mangochi","mangochi","mangochi","mangochi","mangochi","mangochi","mangochi","mangochi","zomba","zomba","zomba","zomba","zomba","zomba","zomba","zomba","zomba","zomba","zomba","zomba","zomba","phalombe","phalombe","phalombe","phalombe","phalombe","phalombe","phalombe","phalombe","phalombe","phalombe","phalombe","phalombe","phalombe","mulanje","mulanje","mulanje","mulanje","mulanje","mulanje","mulanje","mulanje","mulanje","mulanje","mulanje","mulanje","mulanje","mulanje","mulanje","mulanje","mulanje","mulanje","mulanje","thyolo","mwanza","mwanza","mwanza","mwanza","mwanza","mwanza","mwanza","nsanje","nsanje","nsanje","nsanje","nsanje","nsanje","nsanje","nsanje","nsanje","nsanje","nsanje","nsanje","nsanje","nsanje","nsanje","nsanje","nsanje","chikwawa","chikwawa","chikwawa","chikwawa","chikwawa","rumphi","rumphi","rumphi","rumphi","rumphi","rumphi","rumphi","karonga","karonga","rumphi","rumphi","ntchisi","ntchisi","ntchisi","ntchisi","ntchisi","ntchisi","ntchisi","ntchisi","ntchisi","dowa","dowa","dowa","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","mzimba","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu","chiradzulu"],[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>survey_cluster1<\/th>\n      <th>EACODE<\/th>\n      <th>ADM2_EN<\/th>\n      <th>dist_name2<\/th>\n      <th>boundaries_check<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"survey_cluster1","targets":1},{"name":"EACODE","targets":2},{"name":"ADM2_EN","targets":3},{"name":"dist_name2","targets":4},{"name":"boundaries_check","targets":5}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We filtered only the correct district for each cluster, and saved as a dataset containing each cluster (<code>survey_cluster1</code>) and their corresponding district (<code>ADM2_EN</code>).</p>
<p>That dataset (<code>district</code>) was used to exclude those EAs that were not in the corresponding district for each cluster. Note that Likoma is the only district that is missing from the plasma Se dataset (<code>plasma.df</code>), this was not sampled (or sampled but included in Salima as the number of samples were too small).</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the cluster and corresponding district</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>district <span class="ot">&lt;-</span> plasma.df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(boundaries_check <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(survey_cluster1, ADM2_EN)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Then we check that we have all the cluster covered</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(plasma.df<span class="sc">$</span>survey_cluster1))<span class="sc">-</span> <span class="fu">length</span>(<span class="fu">unique</span>(district<span class="sc">$</span>survey_cluster1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># knitr::kable(district)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking Likoma in plasma dataset</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>plasma.df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(dist_name2 <span class="sc">==</span> <span class="st">"likoma"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(survey_cluster1, ADM2_EN, dist_name2) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 3
# ℹ 3 variables: survey_cluster1 &lt;dbl&gt;, ADM2_EN &lt;chr&gt;, dist_name2 &lt;chr&gt;</code></pre>
</div>
</div>
<p>Another district that has a minor difference is “Zomba”, as for sampling is often divided between rural (“Zomba”) and urban (“Zomba City”). We checked and the entries corresponding to Zomba and were all rural.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking Zomba in plasma dataset</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>plasma.df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(dist_name2 <span class="sc">==</span> <span class="st">"zomba"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(survey_cluster1, urbanity) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  survey_cluster1 urbanity
            &lt;dbl&gt; &lt;fct&gt;   
1             218 2       
2              64 2       
3             842 2       </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking Zomba City in plasma dataset</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>plasma.df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(ADM2_EN <span class="sc">==</span> <span class="st">"Zomba City"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(survey_cluster1, EACODE, ADM2_EN, dist_name2, urbanity) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 5
  survey_cluster1   EACODE ADM2_EN    dist_name2 urbanity
            &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;fct&gt;   
1             218 30307901 Zomba City zomba      2       
2             218 30335001 Zomba City zomba      2       
3             218 30307033 Zomba City zomba      2       
4             218 30301044 Zomba City zomba      2       
5             218 30335002 Zomba City zomba      2       
6             218 30335004 Zomba City zomba      2       
7             218 30335003 Zomba City zomba      2       </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking Zomba City in plasma dataset</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>plasma.df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(dist_name2 <span class="sc">==</span> <span class="st">"zomba"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(survey_cluster1, EACODE, ADM2_EN, dist_name2, urbanity) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 128 × 5
   survey_cluster1   EACODE ADM2_EN dist_name2 urbanity
             &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;fct&gt;   
 1             218 30307024 Zomba   zomba      2       
 2             218 30301017 Zomba   zomba      2       
 3             218 30301031 Zomba   zomba      2       
 4             218 30301019 Zomba   zomba      2       
 5             218 30307809 Zomba   zomba      2       
 6             218 30301045 Zomba   zomba      2       
 7             218 30307023 Zomba   zomba      2       
 8             218 30307807 Zomba   zomba      2       
 9             218 30307019 Zomba   zomba      2       
10             218 30307021 Zomba   zomba      2       
# ℹ 118 more rows</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generating the map</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dist_bnd) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">fill =</span> <span class="st">"white"</span>, </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">col =</span> <span class="st">"#666666"</span>, <span class="at">col_alpha =</span> <span class="fl">0.3</span>, <span class="at">lwd =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(malawi_bnd) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"#666666"</span>, <span class="at">fill_alpha =</span> <span class="fl">0.6</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(malawi_bnd_lakes) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">fil_alpha =</span> <span class="fl">0.6</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_shape</span>(ea_admin <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Zomba"</span>,ADM2_EN))) <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">fill =</span><span class="st">"ADM2_EN"</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">col_alpha =</span> <span class="fl">0.3</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="data-boundaries_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Finally, we exlcuded those that were on the “wrong” districts, including those that were in “Zomba City”, as the were all rural.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Excluding EAs that were not with the corresponding district for each cluster</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>plasma.df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(district, plasma.df)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking Zomba City in plasma dataset</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>plasma.df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(ADM2_EN <span class="sc">==</span> <span class="st">"Zomba City"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(survey_cluster1, EACODE, ADM2_EN, dist_name2, urbanity) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 5
# ℹ 5 variables: survey_cluster1 &lt;dbl&gt;, EACODE &lt;dbl&gt;, ADM2_EN &lt;chr&gt;,
#   dist_name2 &lt;chr&gt;, urbanity &lt;fct&gt;</code></pre>
</div>
</div>
<p>Finally, we generated the administrative boundaries master file which contains information on each cluster (<code>survey_cluster1</code>) and its cluster-EA level (all the EAs within the corresponding buffer areas and district) and the district. The codes (<code>EACODE</code> and <code>ADM2_PCODE</code>) can be bind with the respective shapefiles (<code>ea_bnd</code>, <code>ea_admin</code> or <code>dist_bnd</code>).</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Saving the master file with the survey cluster (id) and the admin level</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># EAs, districts, and regions.</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>plasma.df <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(survey_cluster1, EACODE, urbanity, </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                        ADM2_PCODE, ADM2_EN, ADM1_PCODE, ADM1_EN) <span class="sc">%&gt;%</span> </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ADM1_EN))  <span class="sc">%&gt;%</span> <span class="co"># Only one NA as per above</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">saveRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"inter-output"</span>, <span class="st">"aggregation"</span>, <span class="st">"master-cluster-admin-level.RDS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="districts-in-malawi" class="level4" data-number="3.1.1.2">
<h4 data-number="3.1.1.2" class="anchored" data-anchor-id="districts-in-malawi"><span class="header-section-number">3.1.1.2</span> Districts in Malawi</h4>
<p>Here we are showing a map of the districts of Malawi.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate boundaries the whole country (with lakes)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>malawi_bnd_lakes <span class="ot">&lt;-</span> <span class="fu">st_union</span>(ea_bnd)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate boundaries the whole country</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>malawi_bnd <span class="ot">&lt;-</span> <span class="fu">st_union</span>(ea_admin)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Generating the map</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dist_bnd) <span class="sc">+</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">fill =</span> <span class="st">"white"</span>, </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">col =</span> <span class="st">"#666666"</span>, <span class="at">col_alpha =</span> <span class="fl">0.3</span>, <span class="at">lwd =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(malawi_bnd) <span class="sc">+</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"#666666"</span>, <span class="at">fill_alpha =</span> <span class="fl">0.6</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(malawi_bnd_lakes) <span class="sc">+</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">fil_alpha =</span> <span class="fl">0.6</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_shape</span>(ea_admin<span class="sc">$</span>geometry[ea_admin<span class="sc">$</span>EACODE <span class="sc">%in%</span> <span class="fu">unique</span>(geodata_ea<span class="sc">$</span>EACODE)]) <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">fill =</span><span class="st">"firebrick4"</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">col_alpha =</span> <span class="fl">0.3</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="data-boundaries_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="household-catchment-areas-buffer" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="household-catchment-areas-buffer"><span class="header-section-number">3.1.2</span> Household catchment areas (buffer)</h3>
<p>For the household catchment areas, ideally, we would like to test the aggregation of the maize grain Se as function of the distance from each household. For instance, with buffered areas around the household, that could be identified as “food-sheds” or “food catchment areas”. However, as explained in previous sections, the location used to generate the buffer are not the real household location but an approximation. By generating bigger than the displacement area buffers we aim to capture the plausible “food catchment area” for each WRA in the sample while accounting for the error/bias due to the displacement.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the cluster and their centroid to generate the two buffered areas.</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>GPS <span class="ot">&lt;-</span> plasma.df <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(survey_cluster1, Longitude, Latitude)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Transforming maize data.frame into a spatial object (geometry) </span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>geogps <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(GPS , <span class="at">coords =</span><span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">crs =</span> <span class="st">"EPSG:4326"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The catchment areas represented by buffers around the cluster displaced centroids and three distances selected were:</p>
<ol type="1">
<li><p><strong>15km buffer</strong> to cover the maximum displacement in rural area for the GPS location of the DHS clusters. The maximum displacement in rural area is 10km however, when we tested the 10km buffer, we found that one EA (497) did not have an observed sample within that range, thus we decided to increase the buffer size by 5km, we also tested 12km but it did not provide any improvement from the 10km buffer.</p></li>
<li><p><strong>25 and 30km buffer</strong> that cover a sensible distance between EAs and district, and which is according to REF, the average distance between households and the closest market in Malawi (REF).</p></li>
</ol>
<p>The genereation of the buffer is done using a loop, that save the shapefiles into the <code>inter-outuput</code> file, and it is design to be able to change the distances of the buffer if new evidence of bigger or smaller buffer are published. It also allowed us to do sensitivity analysis on buffer size, see <a href="data-processing.html#sec-sensi" class="quarto-xref"><span>Section 6.4.1.1</span></a>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Choice of buffers (in km)</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>buffer <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">30</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over the number of buffers:</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(buffer)){</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  data.df <span class="ot">&lt;-</span> GPS</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transforming km in m (e.g., 10km = 1000m)</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  distance <span class="ot">&lt;-</span> buffer[i]<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">3</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Buffer in meters </span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  data.df<span class="sc">$</span>buffer <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(geogps<span class="sc">$</span>geometry, <span class="at">dist =</span> distance)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Saving the shapefile with the buffers</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_write</span>(data.df, here<span class="sc">::</span><span class="fu">here</span>( <span class="st">"data"</span>, <span class="st">"inter-output"</span>, </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"boundaries"</span>, </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">paste0</span>(<span class="st">"mwi_gps-buffer"</span>, buffer[i], <span class="st">".shp"</span>)))</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This loop was converted into a function to generate the buffers for reproducibility. So the final set of boundaries were generated using the function <code>buffer_generator()</code> (See function folder).</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-perez2013guidelines" class="csl-entry" role="listitem">
Perez-Heydrich, Carolina, Joshua L Warren, Clara R Burgert, and Michael Emch. 2013. <em>Guidelines on the Use of <span>DHS GPS</span> Data</em>. <span>ICF International</span>. <a href="https://dhsprogram.com/pubs/pdf/SAR8/SAR8.pdf">https://dhsprogram.com/pubs/pdf/SAR8/SAR8.pdf</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./data-dhs.html" class="pagination-link" aria-label="Methods: Cleaning &amp; Exploratory Analysis of the Malawi DHS (2015-2016)">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Methods: Cleaning &amp; Exploratory Analysis of the Malawi DHS (2015-2016)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./data-maize.html" class="pagination-link" aria-label="Cleaning maize grain Se concentration in Malawi">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Cleaning maize grain Se concentration in Malawi</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/LuciaSegovia/geospatial_analysis/edit/main/data-boundaries.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/LuciaSegovia/geospatial_analysis/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>