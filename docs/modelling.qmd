
## Methods: Modelling

# To be tested:

1) Different buffer size (from 5km to 60km)
2) Cluster as random effect
3) Distance to inland water bodies 

### Model considerations

See model framework


### Test 1: Irregular lattice model (areal data)

At EA level, it seemed that the random effect model was performing better than the spatial model, and convolution model.

At district level, it seemed that the convolution model was performing the best, followed quite closely by the random effect. 

For both aggregation levels, the likelihood models were showing opposite results as the other parameters (DIC and CPO). 

### Test 2: Geostatistics & point data

INLA + SPDE 

## Parameter inclusion


The covariates and the rationale for their selection are detailed in section XX. In summary, all the covariates included as potentially explanatory variables for individual variability in plasma Se. The first model to be fitted included all of the covariates plus an spatial random effect modelled using SPDE (@ref-).


```{r}

# Formula for the model
form1 <- log(y) ~ -1 + Intercept +  log(Se_mean) +
  wealth_quintile + BMI +  urbanity + 
  AGE_IN_YEARS +
  log(crp) + log(agp) + f(spatial.field, model = spde) 


```


Then, we tested the same model but excluding the urbanity, and only including rural household. 

```{r}

# Formula for the model
form2 <- log(y) ~ -1 + Intercept +  log(Se_mean) +
  wealth_quintile + BMI +  urbanity + 
  AGE_IN_YEARS +
  log(crp) + log(agp) + f(spatial.field, model = spde) +
  f(ID, model = 'iid')


```

Then, we added the cluster as random effect

## Model 3

We added the variable distance to water body (`dist_to_wb`) to the model. This variable was not normally distrubuted following the skewerness and ocktile skerness ranges. Hence, we needed to log tranform and hence we decided to change the 0 values to 200. On the basis that this distance was smaller than the min. distance and smaller than the displacement (2.5km smalles for urban), as it is impossible that the distance to a water body is 0m. 

Then we tested againt the 10aggregation unit. Again, the main conclusion remained the same, hence only age and maize Se concentation were significantly associated with plasma Se concentration. However, adding distance to the water body improved the overall performance of the models. 

# Results

The four models for the 10 aggregation units performed similarly, with the main conclusion being the same. Maize Se and age are important covariates irrespectively of the aggregation level. 




# Model assumptions

### Model testing

#### INLA SPDE

First we select the data, we are testing 10 levels of aggregation as explained in sec. XX, which are the following:

`r print(file)`

We are then applying the same model to the 10 different level of aggregation, so we create a loop that perform the individual steps for all 10 datasets and stores the model output. 






# Model selection


# Model validation & checks


## Sensitivity

The model is robust as the conclusion remained the same through out the three model tested, 

### Household displacement

In order to see how the displacement may potentially affect the model results. We have displaced all/ X% of the sample within range. Hence, the point locations were displaced by 2km, and the analysis were re-run. 


### INLA resources

Tutorial & good visualisation
https://ourcodingclub.github.io/tutorials/inla/




